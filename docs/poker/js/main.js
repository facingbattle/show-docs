"use strict";var bindEventPokerDeck=function(o){var t=e(".poker-deck"),r=!1;t.addEventListener("click",function(){r||(r=!0,log("inner",r),0<t.querySelectorAll(".poker-cell").length&&sendPoker(o,function(){r=!1}))})},sendPoker=function(n,a){for(var l,c,s,o=!0,t=es(".poker-column"),r=0;r<t.length;r++)0===t[r].querySelectorAll(".poker-cell").length&&(o=!1);o?(l=n.pokerSendNum,c=l,s=null,s=setInterval(function(){var o,t,r;c<l+10?(t=120*(o=c-l),null!==(r=e('.poker-column[data-poker-column="'.concat(o,'"]')))&&(r=r.querySelectorAll(".poker-cell").length,animateSendPoker(c,{top:30*r,left:t,pokerRow:r,pokerColumn:o},function(){animateOpenPoker(c)}),c+=1,n.pokerSendNum+=1)):(clearInterval(s),a())},50)):(notice({title:"不允许在有空列的时候发牌"}),a())},bindEventDelegatePokerContainer=function(i){e("#id-poker-container").addEventListener("mousedown",function(o){var t=o.target;if(null!==t.closest(".poker-column")){var r=t.closest(".poker-cell");if(null!==r)if(checkCanPickPoker(r).state){i.moveLeft=o.offsetX,i.moveTop=o.offsetY;for(var n=(i.moveDom=r).dataset.pokerRow,a="",l=r.closest(".poker-column").querySelectorAll(".poker-cell"),c=0;c<l.length;c++){var s=l[c];n<=Number(s.dataset.pokerRow)&&(a+=s.outerHTML,s.dataset.state="move")}t=o.clientX-i.moveLeft,r=o.clientY-i.moveTop,o=e(".poker-move-group");o.style.display="block",o.style.top=r+"px",o.style.left=t+"px",o.insertAdjacentHTML("beforeend",a)}else notice({title:"该卡牌, 不允许被移动"})}})},bindEventDelegateImg=function(){e("#id-poker-container").addEventListener("mousedown",function(e){"IMG"===e.target.tagName&&e.preventDefault()})},checkCanPickPoker=function(e){var o={state:!1,dropPokerRow:0};if("yes"===e.dataset.isOpen){var t=Number(e.dataset.pokerRow),r=[],e=e.closest(".poker-column");if(null===e)return;for(var n=e.querySelectorAll(".poker-cell"),a=0;a<n.length;a++){var l,c=n[a],s=Number(c.dataset.pokerRow);t<=s&&(c=(l=c.dataset.card.split("-"))[0],l=Number(l[1]),r.push({cardColor:c,cardNum:l,pokerRow:s}))}o.state=!0,o.dropPokerRow=t;var i=r.length;if(1<i)for(var p=0;p<i-1;p++){var d=r[p],u=r[p+1],k=d.cardNum===u.cardNum+1,u=d.cardColor===u.cardColor;k&&u||(o.state=!1,o.dropPokerRow=0)}}return o},bindEventBodyMousemove=function(n){e("body").addEventListener("mousemove",function(o){var t,r;n.moveDom&&(t=o.clientX-n.moveLeft,r=o.clientY-n.moveTop,(o=e(".poker-move-group")).style.top=r+"px",o.style.left=t+"px")})},bindEventBodyMouseup=function(b){e("body").addEventListener("mouseup",function(o){if(b.moveDom){var t=e(".poker-move-group"),r=Number(t.style.left.slice(0,-2)),n=e("#id-poker-container").offsetLeft,a=0,a=r<=n+120+10?0:n+1080+10<=r?9:Math.floor((r-n)/120),l=e('.poker-column[data-poker-column="'.concat(a,'"]')),r=l.querySelector(".poker-cell:last-child");if(null!==r){n=b.moveDom.dataset.card.split("-"),n=(n[0],Number(n[1])),r=r.dataset.card.split("-"),r[0];if(n===Number(r[1])-1){var c=t.innerHTML;l.insertAdjacentHTML("beforeend",c);for(var s=l.querySelectorAll(".poker-cell"),i=0;i<s.length;i++){var p=s[i];p.dataset.pokerRow=i,p.dataset.pokerColumn=a}var d=es('.poker-cell[data-state="move"]');if(0<d.length)for(var u=0;u<d.length;u++)d[u].remove()}}else{c=t.innerHTML;l.insertAdjacentHTML("beforeend",c);for(var k=l.querySelectorAll(".poker-cell"),v=0;v<k.length;v++){var f=k[v];f.dataset.pokerRow=1,f.dataset.pokerColumn=a}var m=es('.poker-cell[data-state="move"]');if(0<m.length)for(var g=0;g<m.length;g++)m[g].remove()}var y=es('.poker-cell[data-state="move"]');if(0<y.length)for(var h=0;h<y.length;h++)y[h].dataset.state="";t.style.display="none",t.style.top="0px",t.style.left="0px",t.innerHTML="",b.moveDom=null,b.moveTop=0,b.moveLeft=0}checkNoOpenPoker(b),checkDonePoker(b)})},checkNoOpenPoker=function(e){if(!(e.pokerSendNum<54))for(var o=es(".poker-column"),t=0;t<o.length;t++){var r=o[t].querySelector(".poker-cell:last-child");null!==r&&"no"===r.dataset.isOpen&&(r.dataset.isOpen="yes")}},checkDonePoker=function(e){if(!(e.pokerSendNum<54)){var o=es('.poker-column .poker-cell[data-is-open="yes"][data-card$="-12"]');if(0!==o.length)for(var t=0;t<o.length;t++){var r=o[t],n=r.dataset.card.split("-"),a=n[0],l=(Number(n[1]),Number(r.dataset.pokerRow)),c=r.closest(".poker-column"),s=!0,i=[],r=r.dataset.index;i.push(r);for(var p=1;p<=12;p++){var d=c.querySelector('.poker-cell[data-is-open="yes"][data-poker-row="'.concat(l+p,'"]'));if(null===d){s=!1;break}var u=d.dataset.index;if(i.push(u),d.dataset.card!==a+"-"+(12-p)){s=!1;break}}s&&(i.reverse(),moveDonePoker(i,e))}}},moveDonePoker=function(a,l){for(var c=e(".poker-done-group"),s=c.offsetTop,i=c.offsetLeft,p="",o=0;o<a.length;o++)!function(o){var t=a[o],r=e('.poker-cell[data-index="'.concat(t,'"]')),n=r.offsetTop,t=r.offsetLeft;r.classList.remove("importantClass"),r.style.position="fixed",r.style.top=n+"px",r.style.left=t+"px",p+=r.outerHTML,animate(r,{top:s+"px",left:i+"px"},"linear",function(){r.remove(),o===a.length-1&&(c.insertAdjacentHTML("beforeend",p),checkNoOpenPoker(l),l.pokerDoneGroupNum+=1,8===l.pokerDoneGroupNum&&notice({title:"恭喜您! 成功过关!"}))})}(o)},bindEventsDelegate=function(e){bindEventDelegateImg(),bindEventDelegatePokerContainer(e)},bindEvents=function(e){bindEventPokerDeck(e),bindEventBodyMousemove(e),bindEventBodyMouseup(e)},__main=function(){var e=new Poker;renderView(),chooseGameDifficulty(e),bindEventsDelegate(e),bindEvents(e)};__main();